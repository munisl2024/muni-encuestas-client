<div class="min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50">
    <div class="container mx-auto px-4 sm:px-6 py-6 sm:py-8">

        <!-- Header con botón volver -->
        <div class="bg-white border border-gray-300 rounded-xl shadow-sm p-4 sm:p-6 mb-6">
            <div class="flex  flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                <div class="flex items-center space-x-3 sm:space-x-4">
                    <button (click)="volver()"
                        class="flex items-center space-x-2 px-4 py-2.5 bg-gray-800 text-white text-sm font-medium rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-200 shadow-sm">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Crear Nuevo Barrio</h1>
                        <p class="text-gray-600 text-sm mt-1">Define las coordenadas y descripción del barrio</p>
                    </div>
                </div>

                <!-- Progreso visual -->
                <div class="flex items-center space-x-2 text-sm">
                    <div class="flex items-center space-x-1">
                        <div [class]="barrio.descripcion.trim() ? 'bg-purple-500' : 'bg-gray-300'"
                            class="w-3 h-3 rounded-full transition-colors duration-200"></div>
                        <span class="text-gray-600">Descripción</span>
                    </div>
                    <div class="w-4 h-0.5 bg-gray-300"></div>
                    <div class="flex items-center space-x-1">
                        <div [class]="coordenadas.length >= 3 ? 'bg-purple-500' : 'bg-gray-300'"
                            class="w-3 h-3 rounded-full transition-colors duration-200"></div>
                        <span class="text-gray-600">Polígono</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Formulario -->
            <div class="space-y-6">

                <!-- Tarjeta de información del barrio -->
                <div class="bg-white border border-gray-300 rounded-xl shadow-sm overflow-hidden">
                    <div class="bg-gray-800 px-6 py-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Información del Barrio
                        </h3>
                    </div>
                    <div class="p-6 space-y-6">
                        <div>
                            <label for="descripcion" class="block text-sm font-semibold text-gray-700 mb-3">
                                Descripción del Barrio *
                            </label>
                            <input id="descripcion" type="text" [(ngModel)]="barrio.descripcion"
                                placeholder="Ej: Barrio Centro, Barrio Norte..."
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 text-gray-700 placeholder-gray-400"
                                [disabled]="guardando" />
                        </div>

                        <!-- Información del polígono -->
                        <div
                            class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-4 border border-purple-100">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <svg class="w-4 h-4 mr-2 text-purple-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3" />
                                </svg>
                                Estado del Polígono
                            </h4>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="flex items-center text-sm font-medium text-gray-700">
                                        <span class="w-3 h-3 bg-purple-500 rounded-full mr-2 animate-pulse"></span>
                                        {{ coordenadas.length }} punto{{ coordenadas.length !== 1 ? 's' : '' }}
                                    </span>
                                </div>
                                <span
                                    [class]="coordenadas.length >= 3 ? 'text-green-600 bg-green-100' : 'text-orange-600 bg-orange-100'"
                                    class="px-3 py-1 rounded-full text-xs font-medium">
                                    {{ coordenadas.length >= 3 ? '✓ Válido' : 'Mínimo 3 puntos' }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Instrucciones -->
                <div class="bg-white rounded-xl border border-gray-300 shadow-sm overflow-hidden">
                    <div class="bg-gray-700 px-6 py-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Instrucciones
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3 group">
                                <div
                                    class="flex-shrink-0 w-7 h-7 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-bold group-hover:bg-purple-200 transition-colors">
                                    1
                                </div>
                                <span class="text-gray-700 text-sm">Haz clic en el mapa para agregar puntos al
                                    polígono</span>
                            </div>
                            <div class="flex items-start space-x-3 group">
                                <div
                                    class="flex-shrink-0 w-7 h-7 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-bold group-hover:bg-purple-200 transition-colors">
                                    2
                                </div>
                                <span class="text-gray-700 text-sm">Se requieren mínimo 3 puntos para formar un polígono
                                    válido</span>
                            </div>
                            <div class="flex items-start space-x-3 group">
                                <div
                                    class="flex-shrink-0 w-7 h-7 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-bold group-hover:bg-purple-200 transition-colors">
                                    3
                                </div>
                                <span class="text-gray-700 text-sm">El polígono se dibujará automáticamente al tener 3 o
                                    más puntos</span>
                            </div>
                            <div class="flex items-start space-x-3 group">
                                <div
                                    class="flex-shrink-0 w-7 h-7 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-bold group-hover:bg-purple-200 transition-colors">
                                    4
                                </div>
                                <span class="text-gray-700 text-sm">Usa el botón "Limpiar Mapa" para reiniciar si es
                                    necesario</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Mapa -->
            <div class="space-y-6">
                <div class="bg-white border border-gray-300 rounded-xl shadow-sm overflow-hidden">
                    <div class="bg-gray-800 px-6 py-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3" />
                            </svg>
                            Mapa para Crear Polígono
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="relative h-[400px] sm:h-[500px]">
                            <!-- Contenedor del mapa -->
                            <div id="mapa-crear-barrio"
                                class="w-full h-full rounded-xl border-2 border-gray-200 bg-gray-100 shadow-inner">
                            </div>

                            <!-- Indicador de carga -->
                            <div *ngIf="mapaCargando"
                                class="absolute inset-0 bg-gray-100/95 backdrop-blur-sm rounded-xl flex items-center justify-center z-50">
                                <div class="text-center">
                                    <svg class="animate-spin h-12 w-12 text-purple-600 mx-auto mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <p class="text-gray-700 font-medium">Cargando mapa...</p>
                                    <p class="text-gray-500 text-sm mt-1">Intento {{ intentosInicializacion }} de {{ maxIntentos }}</p>
                                </div>
                            </div>

                            <!-- Mensaje de error -->
                            <div *ngIf="mapaError && !mapaCargando"
                                class="absolute inset-0 bg-red-50/95 backdrop-blur-sm rounded-xl flex items-center justify-center z-50">
                                <div class="text-center p-6">
                                    <svg class="h-12 w-12 text-red-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                    </svg>
                                    <p class="text-red-700 font-medium mb-2">Error al cargar el mapa</p>
                                    <p class="text-red-600 text-sm mb-4">No se pudo inicializar el mapa correctamente</p>
                                    <button (click)="recargarMapa()"
                                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 text-sm font-medium">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                        </svg>
                                        Reintentar
                                    </button>
                                </div>
                            </div>

                            <!-- Indicador de estado (solo cuando el mapa está cargado) -->
                            <div *ngIf="mapaInicializado && !mapaCargando && !mapaError"
                                class="absolute top-4 left-4 bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-4 py-2 rounded-lg text-sm shadow-lg">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Creando Polígono
                            </div>

                            <!-- Contador de puntos -->
                            <div *ngIf="mapaInicializado && !mapaCargando"
                                class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg text-sm text-gray-700 shadow-lg border border-gray-200">
                                <span class="font-semibold">{{ coordenadas.length }}</span> punto{{ coordenadas.length
                                !== 1 ? 's' : '' }}
                            </div>

                            <!-- Botón de recarga (visible cuando el mapa está cargado) -->
                            <div *ngIf="mapaInicializado && !mapaCargando && !mapaError"
                                class="absolute bottom-4 right-4">
                                <button (click)="recargarMapa()" title="Recargar mapa"
                                    class="bg-white/90 backdrop-blur-sm p-2.5 rounded-lg text-gray-700 hover:bg-white hover:text-purple-600 shadow-lg border border-gray-200 transition-all duration-200 hover:scale-110">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botón limpiar mapa -->
                <div class="flex justify-center">
                    <button (click)="limpiarMapa()" [disabled]="coordenadas.length === 0 || guardando"
                        class="px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-sm font-medium shadow-lg transition-all duration-200">
                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        Limpiar Mapa
                    </button>
                </div>
            </div>
        </div>

        <!-- Botones de acción -->
        <div class="mt-8 bg-white rounded-xl shadow-sm border border-purple-100 p-6">
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-3 sm:space-y-0 sm:space-x-4">
                <button (click)="cancelar()" [disabled]="guardando"
                    class="w-full sm:w-auto px-8 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-sm font-medium shadow-lg transition-all duration-200">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    Cancelar
                </button>

                <button (click)="guardarBarrio()"
                    [disabled]="!barrio.descripcion.trim() || coordenadas.length < 3 || guardando"
                    class="w-full sm:w-auto px-8 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-sm font-medium shadow-lg transition-all duration-200">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    {{ guardando ? 'Creando...' : 'Crear Barrio' }}
                </button>
            </div>

            <!-- Texto de ayuda -->
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-500">
                    Asegúrate de completar la descripción y agregar al menos 3 puntos al polígono antes de crear el
                    barrio.
                </p>
            </div>
        </div>

    </div>
</div>