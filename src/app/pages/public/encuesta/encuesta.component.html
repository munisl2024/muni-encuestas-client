<!-- Fondo moderno con gradiente claro -->
<div class="min-h-screen bg-gradient-to-br from-sky-50 via-blue-50 to-indigo-100 relative overflow-hidden">

    <!-- Header con glassmorphism -->
    <div class="relative z-10">
        <div class="bg-white/90 backdrop-blur-xl border-b-2 border-gray-200 shadow-xl">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4 md:flex md:items-center md:justify-between">

                <!-- Logo y título -->
                <div class="flex items-center gap-3 sm:gap-4">
                    <div class="relative group">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-sky-400 to-emerald-400 rounded-xl sm:rounded-2xl blur-md sm:blur-lg opacity-50 group-hover:opacity-75 transition-all duration-300">
                        </div>
                        <div
                            class="relative w-12 h-12 sm:w-14 sm:h-14 bg-white/10 backdrop-blur-sm rounded-xl sm:rounded-2xl flex items-center justify-center border-2 border-white/30">
                            <img src="assets/svg/muni-encuestas-icon.svg"
                                class="w-8 h-8 sm:w-10 sm:h-10 group-hover:scale-110 group-hover:rotate-6 transition-all"
                                alt="Logo">
                        </div>
                    </div>
                    <div>
                        <h1 class="text-lg sm:text-xl font-bold text-slate-800">
                            Responder Encuesta
                        </h1>
                        <p class="text-xs sm:text-sm capitalize text-slate-600" *ngIf="authService.usuario">
                            {{ authService.usuario.apellido.toLowerCase() }}, {{
                            authService.usuario.nombre.toLowerCase() }}
                        </p>
                    </div>
                </div>

                <!-- Botón volver -->
                <button (click)="volver()"
                    class="flex items-center w-full md:w-auto justify-center ml-auto md:ml-0 gap-2 mt-3 md:mt-0 px-4 py-2.5 rounded-xl transition-all duration-300 shadow-lg active:scale-95 sm:hover:shadow-xl sm:hover:scale-105 border-2 bg-white hover:bg-gray-50 text-slate-700 border-gray-300 hover:border-gray-400">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    <span class="font-semibold text-sm sm:text-base">Volver</span>
                </button>

            </div>
        </div>
    </div>

    <!-- Loading mientras se carga la encuesta -->
    <div *ngIf="cargandoEncuesta" class="relative z-10 min-h-screen flex items-center justify-center py-8 px-4">
        <div class="text-center">
            <div class="inline-flex items-center justify-center w-24 h-24 mb-4">
                <svg class="animate-spin w-16 h-16 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </div>
            <p class="text-lg font-medium text-slate-600">Cargando encuesta...</p>
        </div>
    </div>

    <!-- Encuesta desactivada -->
    <div *ngIf="!cargandoEncuesta && encuesta?.estado !== 'Activa' && !encuestaCompletada"
        class="relative z-10 min-h-screen flex items-center justify-center py-8 px-4 sm:px-6">
        <div class="max-w-2xl mx-auto w-full">

            <!-- Efecto glow -->
            <div class="absolute inset-0 bg-gradient-to-r from-red-500 to-rose-600 rounded-2xl sm:rounded-3xl blur-2xl sm:blur-3xl opacity-20">
            </div>

            <div class="relative bg-white/90 backdrop-blur-md rounded-2xl sm:rounded-3xl border-2 border-gray-200 shadow-2xl p-6 sm:p-8 md:p-12 text-center">

                <!-- Icono de encuesta desactivada -->
                <div class="relative inline-block mb-4 sm:mb-6">
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-red-500 to-rose-600 rounded-full blur-lg sm:blur-xl opacity-50">
                    </div>
                    <div
                        class="relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-red-600 to-rose-700 rounded-full flex items-center justify-center shadow-xl">
                        <svg class="w-10 h-10 sm:w-12 sm:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </div>
                </div>

                <!-- Mensaje -->
                <h2 class="text-2xl sm:text-3xl font-bold mb-2 sm:mb-3 text-slate-800">Encuesta desactivada</h2>
                <p class="text-base sm:text-lg mb-6 sm:mb-8 text-slate-600">
                    Esta encuesta se encuentra actualmente desactivada y no está disponible para responder.
                </p>

                <!-- Información de la encuesta -->
                <div class="bg-gray-50 backdrop-blur-sm rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-gray-200">
                    <h3 class="text-lg sm:text-xl font-semibold mb-2 text-slate-800">{{ encuesta?.titulo }}</h3>
                    <p class="text-sm sm:text-base text-slate-600">{{ encuesta?.descripcion }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Encuesta vacía (sin preguntas) -->
    <div *ngIf="!cargandoEncuesta && encuesta?.estado === 'Activa' && (!encuesta?.Preguntas || encuesta?.Preguntas?.length === 0) && !encuestaCompletada"
        class="relative z-10 min-h-screen flex items-center justify-center py-8 px-4 sm:px-6">
        <div class="max-w-2xl mx-auto w-full">

            <!-- Efecto glow -->
            <div class="absolute inset-0 bg-gradient-to-r from-amber-500 to-orange-600 rounded-2xl sm:rounded-3xl blur-2xl sm:blur-3xl opacity-20">
            </div>

            <div class="relative bg-white/90 backdrop-blur-md rounded-2xl sm:rounded-3xl border-2 border-gray-200 shadow-2xl p-6 sm:p-8 md:p-12 text-center">

                <!-- Icono de encuesta vacía -->
                <div class="relative inline-block mb-4 sm:mb-6">
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-amber-500 to-orange-600 rounded-full blur-lg sm:blur-xl opacity-50">
                    </div>
                    <div
                        class="relative w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-amber-600 to-orange-700 rounded-full flex items-center justify-center shadow-xl">
                        <svg class="w-10 h-10 sm:w-12 sm:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                </div>

                <!-- Mensaje -->
                <h2 class="text-2xl sm:text-3xl font-bold mb-2 sm:mb-3 text-slate-800">Encuesta vacía</h2>
                <p class="text-base sm:text-lg mb-6 sm:mb-8 text-slate-600">
                    Esta encuesta no contiene preguntas en este momento. No es posible enviar respuestas.
                </p>

                <!-- Información de la encuesta -->
                <div class="bg-amber-50 backdrop-blur-sm rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-amber-200">
                    <h3 class="text-lg sm:text-xl font-semibold mb-2 text-slate-800">{{ encuesta?.titulo }}</h3>
                    <p class="text-sm sm:text-base text-slate-600">{{ encuesta?.descripcion }}</p>

                    <div class="mt-4 flex items-center justify-center gap-2 text-amber-700">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="font-medium text-sm sm:text-base">Por favor contacta al administrador</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Encuesta activa con preguntas -->
    <div *ngIf="!cargandoEncuesta && encuesta?.estado === 'Activa' && encuesta?.Preguntas && encuesta?.Preguntas?.length > 0 && !encuestaCompletada" class="relative z-10 py-6 sm:py-8 px-4 sm:px-6">
        <div class="max-w-3xl mx-auto">

            <!-- Header de la encuesta con glassmorphism -->
            <div class="relative mb-6 sm:mb-8">
                <!-- Efecto glow -->
                <div
                    class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl sm:rounded-3xl blur-2xl sm:blur-3xl opacity-20">
                </div>

                <div class="relative bg-white/90 backdrop-blur-md rounded-2xl sm:rounded-3xl border-2 border-gray-200 shadow-2xl p-5 sm:p-6 md:p-8">
                    <div class="text-center">
                        <!-- Ícono con efecto -->
                        <div class="relative inline-block mb-3 sm:mb-4">
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-full blur-lg sm:blur-xl opacity-50">
                            </div>
                            <div
                                class="relative w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center shadow-xl">
                                <svg class="w-7 h-7 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                        </div>

                        <h1 class="text-2xl sm:text-3xl font-bold mb-2 sm:mb-3 text-slate-800">
                            {{ encuesta?.titulo }}
                        </h1>
                        <p class="text-base sm:text-lg text-slate-600">{{ encuesta?.descripcion }}</p>
                    </div>

                    <!-- Indicador de progreso -->
                    <div class="mt-5 sm:mt-6 pt-5 sm:pt-6 border-t border-gray-300">
                        <div class="flex items-center justify-between mb-2 sm:mb-3">
                            <span class="text-xs sm:text-sm font-medium text-slate-700">Progreso de la encuesta</span>
                            <span class="text-xs sm:text-sm font-semibold text-emerald-600">
                                {{ respuestasSeleccionadas.size }} / {{ encuesta?.Preguntas?.length || 0 }}
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 sm:h-3 overflow-hidden backdrop-blur-sm">
                            <div class="bg-gradient-to-r from-emerald-500 to-teal-500 h-2.5 sm:h-3 rounded-full transition-all duration-500 shadow-lg"
                                [style.width.%]="(respuestasSeleccionadas.size / (encuesta?.Preguntas?.length || 1)) * 100">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulario de Datos Personales -->
            <div class="relative mb-6 sm:mb-8">
                <!-- Efecto glow -->
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl sm:rounded-3xl blur-2xl sm:blur-3xl opacity-20"></div>

                <div class="relative bg-white/90 backdrop-blur-md rounded-2xl sm:rounded-3xl border-2 border-gray-200 shadow-2xl p-5 sm:p-6 md:p-8">
                    <!-- Header -->
                    <div class="flex items-center gap-3 mb-5 sm:mb-6 pb-4 border-b border-gray-300">
                        <div class="relative flex-shrink-0">
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full blur-md sm:blur-lg opacity-50"></div>
                            <div class="relative w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                        </div>
                        <div>
                            <h2 class="text-xl sm:text-2xl font-bold text-slate-800">Datos Personales</h2>
                            <p class="text-xs sm:text-sm text-slate-600">Por favor completa tus datos antes de responder</p>
                        </div>
                    </div>

                    <!-- Formulario -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5 md:gap-6">
                        <!-- Barrio con buscador -->
                        <div class="space-y-2 md:col-span-2">
                            <label class="block text-xs sm:text-sm font-semibold text-slate-700">
                                Barrio <span class="text-red-500">*</span>
                            </label>

                            <!-- Select con buscador personalizado -->
                            <div class="relative">
                                <!-- Input que muestra el barrio seleccionado y permite buscar -->
                                <div class="relative">
                                    <input
                                        type="text"
                                        [(ngModel)]="busquedaBarrio"
                                        (focus)="abrirDropdownBarrios()"
                                        (blur)="cerrarDropdownBarrios()"
                                        (input)="filtrarBarrios()"
                                        placeholder="Buscar barrio..."
                                        class="w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 text-sm sm:text-base rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all duration-300 bg-white/50 backdrop-blur-sm"
                                        [class.border-red-400]="!datosPersonales.barrioId && respuestasSeleccionadas.size > 0"
                                        [class.font-semibold]="datosPersonales.barrioId && !showDropdownBarrios"
                                        autocomplete="off"
                                    />
                                    <!-- Icono de dropdown -->
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400" [class.rotate-180]="showDropdownBarrios"
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"
                                             style="transition: transform 0.2s">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                </div>

                                <!-- Dropdown de opciones -->
                                <div *ngIf="showDropdownBarrios && !cargandoBarrios"
                                     class="barrios-dropdown absolute z-50 w-full mt-2 bg-white rounded-xl border-2 border-gray-300 shadow-xl max-h-60 overflow-auto">

                                    <!-- Mensaje si no hay resultados -->
                                    <div *ngIf="barriosFiltrados.length === 0"
                                         class="px-4 py-3 text-sm text-gray-500 text-center">
                                        No se encontraron barrios
                                    </div>

                                    <!-- Lista de barrios filtrados -->
                                    <button
                                        *ngFor="let barrio of barriosFiltrados"
                                        type="button"
                                        (mousedown)="seleccionarBarrio(barrio)"
                                        class="w-full text-left px-4 py-3 hover:bg-blue-50 transition-colors duration-150 flex items-center justify-between group"
                                        [class.bg-blue-100]="datosPersonales.barrioId === barrio.id"
                                    >
                                        <span class="text-slate-700 group-hover:text-blue-600"
                                              [class.font-semibold]="datosPersonales.barrioId === barrio.id">
                                            {{ barrio.descripcion }}
                                        </span>

                                        <!-- Check si está seleccionado -->
                                        <svg *ngIf="datosPersonales.barrioId === barrio.id"
                                             class="w-5 h-5 text-blue-600"
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <p *ngIf="cargandoBarrios" class="text-xs text-gray-500 flex items-center gap-1">
                                <svg class="animate-spin w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                                Cargando barrios...
                            </p>
                        </div>

                        <!-- Email -->
                        <div class="space-y-2">
                            <label class="block text-xs sm:text-sm font-semibold text-slate-700">
                                Email <span class="text-orange-500">*</span>
                            </label>
                            <input type="email"
                                   [(ngModel)]="datosPersonales.email"
                                   placeholder="correo@gmail.com"
                                   class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all duration-300 bg-white/50 backdrop-blur-sm"
                                   [class.border-red-400]="!datosPersonalesCompletos() && respuestasSeleccionadas.size > 0">
                        </div>

                        <!-- Teléfono -->
                        <div class="space-y-2">
                            <label class="block text-xs sm:text-sm font-semibold text-slate-700">
                                Teléfono <span class="text-orange-500">*</span>
                            </label>
                            <input type="tel"
                                   [(ngModel)]="datosPersonales.telefono"
                                   placeholder="2664869642"
                                   class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all duration-300 bg-white/50 backdrop-blur-sm"
                                   [class.border-red-400]="!datosPersonalesCompletos() && respuestasSeleccionadas.size > 0">
                        </div>

                        <!-- Género -->
                        <div class="space-y-2">
                            <label class="block text-xs sm:text-sm font-semibold text-slate-700">Género</label>
                            <select [(ngModel)]="datosPersonales.genero"
                                    class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all duration-300 bg-white/50 backdrop-blur-sm">
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Otro"> Otro </option>
                            </select>
                        </div>

                        <!-- Rango de Edad -->
                        <div class="space-y-2">
                            <label class="block text-xs sm:text-sm font-semibold text-slate-700">Rango de Edad</label>
                            <select [(ngModel)]="datosPersonales.rangoEdad"
                                    class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all duration-300 bg-white/50 backdrop-blur-sm">
                                <option value="18-25">18-25 años</option>
                                <option value="26-35">26-35 años</option>
                                <option value="36-45">36-45 años</option>
                                <option value="45+">45+ años</option>
                            </select>
                        </div>

                        <!-- SIGEM -->
                        <div class="space-y-2">
                            <label class="block text-xs sm:text-sm font-semibold text-slate-700">¿Tiene cuenta SIGEM?</label>
                            <select [(ngModel)]="datosPersonales.sigem"
                                    class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all duration-300 bg-white/50 backdrop-blur-sm">
                                <option [ngValue]="false">No</option>
                                <option [ngValue]="true">Sí</option>
                            </select>
                        </div>
                    </div>

                    <!-- Indicador de campos requeridos -->
                    <div class="mt-5 sm:mt-6 pt-4 border-t border-gray-200">
                        <div class="flex items-start sm:items-center gap-2 sm:gap-3">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0 text-slate-400 mt-0.5 sm:mt-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <div class="text-xs sm:text-sm text-slate-600 leading-relaxed">
                                <p class="mb-1">
                                    El campo <span class="text-red-500 font-bold">barrio</span> es obligatorio.
                                </p>
                                <p>
                                    Debe completar al menos uno de los campos marcados con <span class="text-orange-500 font-bold">*</span> (email o teléfono).
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preguntas -->
            <div class="space-y-4 sm:space-y-5 md:space-y-6">
                <div *ngFor="let pregunta of encuesta?.Preguntas; let i = index" class="relative group">

                    <!-- Efecto glow en pregunta respondida -->
                    <div *ngIf="respuestasSeleccionadas.has(pregunta.id)"
                        [ngClass]="pregunta.multiplesRespuestas ? 'bg-gradient-to-r from-purple-500 to-purple-700' : 'bg-gradient-to-r from-emerald-500 to-teal-500'"
                        class="absolute inset-0 rounded-xl sm:rounded-2xl blur-lg sm:blur-xl opacity-30 transition-all duration-500">
                    </div>

                    <div [class]="getCardClasses(pregunta.id)">

                        <!-- Patrón decorativo - Oculto en móviles -->
                        <div
                            [ngClass]="pregunta.multiplesRespuestas ? 'from-purple-400/10' : 'from-emerald-400/10'"
                            class="hidden sm:block absolute top-0 right-0 w-32 h-32 bg-gradient-to-br to-transparent rounded-full blur-2xl">
                        </div>

                        <!-- Encabezado de la pregunta -->
                        <div class="relative flex items-start gap-3 sm:gap-4 mb-3 sm:mb-4">
                            <div class="flex-shrink-0">
                                <div [class]="getBadgeClasses(pregunta.id)">
                                    <span *ngIf="!respuestasSeleccionadas.has(pregunta.id)">{{ i + 1 }}</span>
                                    <svg *ngIf="respuestasSeleccionadas.has(pregunta.id)" class="w-5 h-5 sm:w-6 sm:h-6" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-base sm:text-lg font-semibold mb-1"
                                    [ngClass]="pregunta.multiplesRespuestas ? 'text-purple-700' : 'text-emerald-700'">Pregunta {{ i + 1 }}</h3>
                                <p class="leading-relaxed text-sm sm:text-base text-slate-700">{{ pregunta.descripcion }}</p>
                            </div>
                        </div>

                        <!-- Opciones de respuesta -->
                        <div class="ml-0 md:ml-15 space-y-2.5 sm:space-y-3 mt-4 sm:mt-6">
                            <!-- Mostrar información si permite múltiples respuestas -->
                            <p *ngIf="pregunta.multiplesRespuestas" class="text-xs sm:text-sm text-purple-600 font-medium mb-2 flex items-center gap-1">
                                <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Puedes seleccionar múltiples opciones
                            </p>

                            <label *ngFor="let respuesta of pregunta.Respuestas" [class]="getAnswerClasses(pregunta.id, respuesta.id)">

                                <!-- Radio para respuesta única -->
                                <input *ngIf="!pregunta.multiplesRespuestas"
                                    type="radio"
                                    [name]="'pregunta_' + pregunta.id"
                                    [value]="respuesta.id"
                                    (change)="seleccionarRespuesta(pregunta.id, respuesta.id, false)"
                                    [checked]="verificarRespuestaSeleccionada(pregunta.id, respuesta.id)"
                                    class="w-4 h-4 sm:w-5 sm:h-5 text-emerald-500 focus:ring-emerald-500 bg-white/20">

                                <!-- Checkbox para múltiples respuestas -->
                                <input *ngIf="pregunta.multiplesRespuestas"
                                    type="checkbox"
                                    [id]="'pregunta_' + pregunta.id + '_respuesta_' + respuesta.id"
                                    (change)="seleccionarRespuesta(pregunta.id, respuesta.id, true)"
                                    [checked]="verificarRespuestaSeleccionada(pregunta.id, respuesta.id)"
                                    class="w-4 h-4 sm:w-5 sm:h-5 text-purple-600 focus:ring-purple-500 bg-white/20 rounded">

                                <span [class]="getAnswerTextClasses(pregunta.id, respuesta.id)">
                                    {{ respuesta.descripcion }}
                                </span>

                                <svg *ngIf="verificarRespuestaSeleccionada(pregunta.id, respuesta.id)"
                                    class="w-5 h-5 sm:w-6 sm:h-6 ml-2 flex-shrink-0"
                                    [ngClass]="pregunta.multiplesRespuestas ? 'text-purple-500' : 'text-emerald-300'"
                                    fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24" stroke-width="3">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                </svg>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botón de enviar -->
            <div class="mt-6 sm:mt-8 relative">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl sm:rounded-2xl blur-xl sm:blur-2xl opacity-20">
                </div>

                <div class="relative bg-white/90 backdrop-blur-md rounded-xl sm:rounded-2xl border-2 border-gray-200 shadow-2xl p-4 sm:p-5 md:p-6">
                    <button (click)="enviarRespuestas()" [disabled]="!formularioCompleto() || enviando" [class]="getSubmitButtonClasses()">

                        <svg *ngIf="!enviando" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>

                        <svg *ngIf="enviando" class="animate-spin w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>

                        <span *ngIf="!enviando" class="text-sm sm:text-base md:text-lg">{{ formularioCompleto() ? 'Enviar respuestas' : (!datosPersonalesCompletos() ? (!datosPersonales.barrioId ? 'Selecciona un barrio' : 'Completa email o teléfono') : 'Completa todas las preguntas') }}</span>
                        <span *ngIf="enviando" class="text-sm sm:text-base md:text-lg">Enviando...</span>
                    </button>

                    <p *ngIf="!datosPersonales.barrioId"
                        class="text-center text-sm mt-4 flex items-center justify-center gap-2 text-slate-500">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Por favor selecciona un barrio
                    </p>

                    <p *ngIf="datosPersonales.barrioId && !datosPersonalesCompletos()"
                        class="text-center text-sm mt-4 flex items-center justify-center gap-2 text-slate-500">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Por favor completa al menos un email o un teléfono
                    </p>

                    <p *ngIf="datosPersonalesCompletos() && !todasLasPreguntasRespondidas()"
                        class="text-center text-sm mt-4 flex items-center justify-center gap-2 text-slate-500">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Por favor responde todas las preguntas antes de enviar
                    </p>
                </div>
            </div>

        </div>
    </div>

    <!-- Pantalla de éxito -->
    <div *ngIf="!cargandoEncuesta && encuestaCompletada" class="relative z-10 min-h-screen flex items-center justify-center py-8 px-4 sm:px-6">
        <div class="max-w-2xl mx-auto w-full">

            <!-- Efecto glow -->
            <div
                class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl sm:rounded-3xl blur-2xl sm:blur-3xl opacity-30 animate-pulse">
            </div>

            <div class="relative bg-white/90 backdrop-blur-md rounded-2xl sm:rounded-3xl border-2 border-gray-200 shadow-2xl p-6 sm:p-8 md:p-12 text-center">

                <!-- Icono de éxito -->
                <div class="relative inline-block mb-5 sm:mb-6">
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-full blur-xl sm:blur-2xl opacity-60 animate-pulse">
                    </div>
                    <div
                        class="relative w-24 h-24 sm:w-28 sm:h-28 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center shadow-2xl animate-bounce">
                        <svg class="w-12 h-12 sm:w-14 sm:h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                </div>

                <!-- Mensaje de éxito -->
                <h2 class="text-3xl sm:text-4xl font-bold mb-3 sm:mb-4 text-slate-800">
                    ¡Encuesta completada!
                </h2>
                <p class="text-base sm:text-lg mb-6 sm:mb-8 leading-relaxed text-slate-600">
                    Tus respuestas han sido enviadas correctamente.<br class="hidden sm:block">
                    Gracias por tu participación.
                </p>

                <!-- Botón para responder de nuevo -->
                <button (click)="reiniciarEncuesta()"
                    class="group relative inline-flex items-center gap-2 sm:gap-3 px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-sky-600 to-blue-600 hover:from-sky-700 hover:to-blue-700 text-white font-semibold text-sm sm:text-base rounded-xl shadow-xl active:scale-95 sm:hover:shadow-2xl sm:hover:shadow-sky-500/50 transition-all duration-300 border-2 border-sky-500/50 hover:border-sky-400 sm:hover:scale-105">

                    <!-- Glow effect -->
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-sky-400 to-blue-400 rounded-xl blur-lg opacity-0 group-hover:opacity-40 transition-opacity duration-300">
                    </div>

                    <svg class="relative w-5 h-5 sm:w-6 sm:h-6 group-hover:rotate-180 transition-transform duration-500" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span class="relative">Responder nuevamente</span>
                </button>

                <!-- Decoración adicional -->
                <div class="mt-6 sm:mt-8 flex items-center justify-center gap-2 text-xs sm:text-sm text-slate-500">
                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                    <span>Tu participación es muy importante</span>
                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse" style="animation-delay: 0.5s;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="relative z-10 py-6">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-slate-500">
                © 2025 Municipalidad - Todos los derechos reservados
            </p>
        </div>
    </div>

</div>
