<app-abm-encuestas (insertEvent)="nuevaEncuesta($event)" (updateEvent)="actualizarEncuesta($event)"></app-abm-encuestas>

<!-- Listado de encuestas -->
<div class="container mx-auto">
    <app-tarjeta-lista>
        <div class="container mx-auto">
            <div>
                <div
                    class="md:flex md:items-center md:justify-between bg-gradient-to-r from-gray-800 to-gray-700 px-6 py-4 rounded-t">
                    <div class="flex items-center">
                        <div class="bg-white p-2 rounded-lg shadow-md">
                            <img src="assets/svg/encuestas.svg" class="icono-tabla">
                        </div>
                        <div class="ml-4 text-white">
                            <h2 class="titulo-tabla">
                                Encuestas
                            </h2>
                            <p class="subtitulo-tabla"> Total de encuestas: {{ this.encuestasService.total }} </p>
                        </div>
                    </div>
                    <div *ngIf="authService.isAdmin" class="flex items-center mt-4 md:mt-0 space-x-3">
                        <button title="Nueva encuesta" (click)="encuestasService.abrirAbm('crear')"
                            class="boton-tabla-nuevo">
                            <span class="font-medium">Nueva encuesta</span>
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="bg-white border-b td-tabla">
                    <div class="md:flex md:items-center md:justify-between">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full">
                            <div class="relative">
                                <select (change)="cambiarPagina(1)" [(ngModel)]="filtro.estado" class="input-tabla">
                                    <option value='Inactiva'>Inactivas</option>
                                    <option value='Activa'>Activas</option>
                                    <option value=''>Todas</option>
                                </select>
                            </div>

                            <div class="relative">
                                <input #buscadorEncuestas placeholder="Buscar encuesta..."
                                    class="input-tabla-buscador" />
                                <svg *ngIf="!cargandoEncuestas" class="absolute left-3 top-3 h-4 w-4 text-gray-400"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <div *ngIf="cargandoEncuestas" class="absolute left-3 top-3">
                                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"></div>
                                </div>
                            </div>

                            <select (change)="cambiarPagina(1)" [(ngModel)]="cantidadItems" class="input-tabla">
                                <option value="10">10 elementos</option>
                                <option value="20">20 elementos</option>
                                <option value="50">50 elementos</option>
                                <option value="100">100 elementos</option>
                            </select>

                        </div>
                    </div>
                </div>

                <!-- Tabla Desktop -->
                <div class="hidden md:block overflow-x-auto">
                    <div class="inline-block min-w-full">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="th-tabla">
                                        <div (click)="ordenarPorColumna('id')"
                                            class="group cursor-pointer flex items-center">
                                            <span> Numero </span>
                                            <span class="ml-2 text-gray-400 group-hover:text-gray-700">
                                                <svg *ngIf="ordenar.columna == 'id' && ordenar.direccion == 'asc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M19 9l-7 7-7-7" />
                                                </svg>
                                                <svg *ngIf="ordenar.columna == 'id' && ordenar.direccion == 'desc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 15l7-7 7 7" />
                                                </svg>
                                            </span>
                                        </div>
                                    </th>
                                    <th class="th-tabla">
                                        <div (click)="ordenarPorColumna('titulo')"
                                            class="group cursor-pointer flex items-center">
                                            <span>Título</span>
                                            <span class="ml-2 text-gray-400 group-hover:text-gray-700">
                                                <svg *ngIf="ordenar.columna == 'titulo' && ordenar.direccion == 'asc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M19 9l-7 7-7-7" />
                                                </svg>
                                                <svg *ngIf="ordenar.columna == 'titulo' && ordenar.direccion == 'desc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 15l7-7 7 7" />
                                                </svg>
                                            </span>
                                        </div>
                                    </th>
                                    <th class="th-tabla">
                                        <div (click)="ordenarPorColumna('fechaCreacion')"
                                            class="group cursor-pointer flex items-center justify-center">
                                            <span>Fecha de creación</span>
                                            <span class="ml-2 text-gray-400 group-hover:text-gray-700">
                                                <svg *ngIf="ordenar.columna == 'fechaCreacion' && ordenar.direccion == 'asc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M19 9l-7 7-7-7" />
                                                </svg>
                                                <svg *ngIf="ordenar.columna == 'fechaCreacion' && ordenar.direccion == 'desc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 15l7-7 7 7" />
                                                </svg>
                                            </span>
                                        </div>
                                    </th>
                                    <th class="th-tabla">
                                        <div (click)="ordenarPorColumna('estado')"
                                            class="group cursor-pointer flex items-center justify-center">
                                            <span>Estado</span>
                                            <span class="ml-2 text-gray-400 group-hover:text-gray-700">
                                                <svg *ngIf="ordenar.columna == 'estado' && ordenar.direccion == 'asc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M19 9l-7 7-7-7" />
                                                </svg>
                                                <svg *ngIf="ordenar.columna == 'estado' && ordenar.direccion == 'desc'"
                                                    class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 15l7-7 7 7" />
                                                </svg>
                                            </span>
                                        </div>
                                    </th>
                                    <th class="th-tabla flex items-center justify-center">
                                        <span>Acciones</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                @for(encuesta of this.encuestasService.encuestas | paginate: {itemsPerPage:
                                cantidadItems, currentPage: paginaActual, totalItems: encuestasService.total}; track encuesta.id){
                                <tr class="hover:bg-gray-50 transition-colors duration-200">
                                    <td class="td-tabla">
                                        <div>{{ encuesta.id }}</div>
                                    </td>
                                    <td class="td-tabla">
                                        <div>{{ encuesta.titulo }}</div>
                                    </td>
                                    <td class="td-tabla text-center">
                                        <div>{{ encuesta.createdAt| date:'dd/MM/yyyy' }}</div>
                                    </td>
                                    <td class="td-tabla text-center">
                                        <div>
                                            <span class="px-3 py-1 text-sm font-medium rounded-full" 
                                                  [ngClass]="encuesta.estado === 'Activa' ? 
                                                            'bg-green-100 text-green-800 border border-green-200' : 
                                                            'bg-red-100 text-red-800 border border-red-200'">
                                                {{ encuesta.estado }}
                                            </span>
                                        </div>
                                    </td>
                                    <td class="td-tabla flex items-center justify-center whitespace-nowrap text-center">
                                        <button [routerLink]="['/dashboard/encuestas/detalles', encuesta.id]"
                                            title="Editar encuesta" class="boton-tabla-editar">
                                            <img src="assets/svg/detalles.svg" class="w-4 h-4 opacity-80">
                                            <span class="ml-2"> Detalles </span>
                                        </button>
                                    </td>
                                </tr>
                                }@empty {
                                <tr>
                                    <td colspan="5" class="td-tabla text-center text-sm text-gray-500 bg-gray-50">
                                        No se encontraron encuestas
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vista Móvil -->
                <div class="md:hidden space-y-4 p-4 max-h-[500px] overflow-y-auto">
                    @for(encuesta of this.encuestasService.encuestas | paginate: {itemsPerPage:
                    cantidadItems, currentPage: paginaActual, totalItems: encuestasService.total}; track encuesta.id){
                    <div
                        class="bg-white rounded-lg shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl transition-shadow duration-300">
                        <div class="border-l-4 border-blue-500 p-5">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-semibold text-lg text-gray-900">{{ encuesta.titulo }}</div>
                                    <div class="text-sm text-gray-500 mt-1 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        {{ encuesta.createdAt | date:'dd/MM/yyyy' }}
                                    </div>
                                    <div class="text-sm text-gray-600 mt-1">
                                        Estado: {{ encuesta.estado }}
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 flex items-center justify-end space-x-3">
                                <button [routerLink]="['/dashboard/encuestas/detalles', encuesta.id]"
                                    title="Editar encuesta" class="boton-tabla-editar">
                                    <img src="assets/svg/detalles.svg" class="w-4 h-4 opacity-80">
                                    <span class="ml-2 font-medium">Detalles</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    }@empty {
                    <div class="text-center py-4 text-gray-500 bg-gray-50 rounded-lg">
                        No se encontraron encuestas
                    </div>
                    }
                </div>

                <!-- Paginación -->
                <div
                    class="px-5 py-5 mt-4 text-sm bg-white border-t flex shadow flex-col xs:flex-row items-center xs:justify-between">
                    <pagination-controls nextLabel="Siguiente" previousLabel="Anterior"
                        (pageChange)="cambiarPagina($event)"></pagination-controls>
                </div>

            </div>
        </div>
    </app-tarjeta-lista>
</div>